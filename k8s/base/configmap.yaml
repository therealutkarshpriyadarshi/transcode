apiVersion: v1
kind: ConfigMap
metadata:
  name: transcode-config
  namespace: transcode
data:
  config.yaml: |
    server:
      port: 8080
      host: "0.0.0.0"
      read_timeout: 30s
      write_timeout: 30s
      max_upload_size: 10737418240  # 10GB

    database:
      host: "postgres-service"
      port: 5432
      user: "postgres"
      dbname: "transcode"
      max_open_conns: 25
      max_idle_conns: 5
      conn_max_lifetime: 5m

    redis:
      host: "redis-service"
      port: 6379
      db: 0
      pool_size: 10
      ttl: 3600

    storage:
      endpoint: "s3.amazonaws.com"  # Override in production
      bucket_name: "transcode-videos"
      use_ssl: true
      region: "us-east-1"

    queue:
      host: "rabbitmq-service"
      port: 5672
      user: "guest"
      queue_name: "transcode_jobs"
      prefetch_count: 1
      auto_ack: false

    transcoder:
      worker_count: 4
      temp_dir: "/tmp/transcode"
      ffmpeg_path: "ffmpeg"
      ffprobe_path: "ffprobe"
      max_concurrent_jobs: 4
      gpu_enabled: true
      gpu_selection: "auto"  # auto, manual, round-robin

    monitoring:
      enable_metrics: true
      metrics_port: 9090
      enable_tracing: true
      jaeger_endpoint: "jaeger-collector:14268"

    logging:
      level: "info"
      format: "json"
      output: "stdout"

# Default values for transcode
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: "standard"

namespace: transcode

api:
  replicaCount: 3
  image:
    repository: transcode/api
    tag: latest
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 80
    targetPort: 8080
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 2Gi
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

worker:
  cpu:
    replicaCount: 2
    image:
      repository: transcode/worker
      tag: latest
      pullPolicy: Always
    resources:
      requests:
        cpu: 2000m
        memory: 4Gi
      limits:
        cpu: 4000m
        memory: 8Gi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 20
      targetCPUUtilizationPercentage: 75
  gpu:
    enabled: false
    replicaCount: 1
    image:
      repository: transcode/worker-gpu
      tag: latest
      pullPolicy: Always
    resources:
      requests:
        cpu: 4000m
        memory: 8Gi
        nvidia.com/gpu: 1
      limits:
        cpu: 8000m
        memory: 16Gi
        nvidia.com/gpu: 1
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 5
      targetCPUUtilizationPercentage: 80

postgres:
  enabled: true
  image:
    repository: postgres
    tag: 15-alpine
  storageSize: 100Gi
  resources:
    requests:
      cpu: 1000m
      memory: 2Gi
    limits:
      cpu: 2000m
      memory: 4Gi

redis:
  enabled: true
  image:
    repository: redis
    tag: 7-alpine
  storageSize: 10Gi
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 1000m
      memory: 2Gi

rabbitmq:
  enabled: true
  image:
    repository: rabbitmq
    tag: 3-management-alpine
  storageSize: 20Gi
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 2000m
      memory: 2Gi

monitoring:
  enabled: true
  prometheus:
    enabled: true
    storageSize: 50Gi
    retention: 15d
  grafana:
    enabled: true
    adminPassword: admin
  jaeger:
    enabled: true
  alertmanager:
    enabled: true

ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "10240m"
  hosts:
    - host: api.transcode.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: transcode-tls
      hosts:
        - api.transcode.example.com

networkPolicy:
  enabled: true

secrets:
  postgres:
    password: "changeme-in-production"
  rabbitmq:
    password: "changeme-in-production"
    erlangCookie: "changeme-erlang-cookie"
  jwt:
    secret: "changeme-jwt-secret-key"
  aws:
    accessKeyId: "changeme"
    secretAccessKey: "changeme"
  webhook:
    secret: "changeme-webhook-secret"

config:
  server:
    port: 8080
    host: "0.0.0.0"
  storage:
    endpoint: "s3.amazonaws.com"
    bucketName: "transcode-videos"
    region: "us-east-1"
  transcoder:
    workerCount: 4
    maxConcurrentJobs: 4
    gpuEnabled: false
